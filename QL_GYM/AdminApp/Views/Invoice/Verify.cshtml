@{
    ViewBag.Title = "Kiểm tra Chữ Ký Số";
    // Xác định trạng thái để chọn màu (Xanh lá hoặc Đỏ)
    bool? isValid = null;
    if (ViewBag.Status != null)
    {
        isValid = ViewBag.Status.ToString().Contains("✅");
    }
}

<div class="container" style="margin-top: 30px;">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">

            <h2 class="text-center text-uppercase" style="font-weight: bold; color: #555;">
                🔍 Kiểm tra tính toàn vẹn dữ liệu
            </h2>
            <p class="text-center text-muted">
                Hệ thống xác thực chữ ký số (Digital Signature Verification)
            </p>
            <hr />

            <div class="well">
                <form method="get" action="@Url.Action("Verify", "Invoice")" class="form-horizontal">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="control-label col-md-3">Tên file hóa đơn:</label>
                        <div class="col-md-7">
                            <input type="text" name="file" value="@ViewBag.FileName"
                                   class="form-control" placeholder="Ví dụ: Bill_123.txt" required />
                            <small class="text-muted">Nhập tên file gốc nằm trong thư mục SignedFiles</small>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="glyphicon glyphicon-search"></i> Kiểm tra
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            @if (ViewBag.Status != null)
            {
                <div style="margin-top: 30px; text-align: center;">

                    @if (isValid == true)
                    {
                        // TRƯỜNG HỢP HỢP LỆ
                        <div class="alert alert-success" style="border-left: 5px solid green; padding: 40px;">
                            <i class="glyphicon glyphicon-ok-sign" style="font-size: 60px; color: green;"></i>
                            <h1 style="margin-top: 20px; font-weight: bold;">HỢP LỆ</h1>
                            <p class="lead">@ViewBag.Detail</p>
                            <hr>
                            <p>
                                <span class="label label-success">Toàn vẹn dữ liệu</span>
                                <span class="label label-success">Chữ ký xác thực</span>
                            </p>
                        </div>
                    }
                    else
                    {
                        // TRƯỜNG HỢP LỖI / KHÔNG HỢP LỆ
                        <div class="alert alert-danger" style="border-left: 5px solid red; padding: 40px;">
                            <i class="glyphicon glyphicon-remove-sign" style="font-size: 60px; color: red;"></i>
                            <h1 style="margin-top: 20px; font-weight: bold;">KHÔNG HỢP LỆ</h1>
                            <p class="lead">@ViewBag.Detail</p>

                            <div style="background: #fff; padding: 15px; border-radius: 5px; text-align: left; margin-top: 20px; color: #333;">
                                <strong>⚠️ Các nguyên nhân có thể xảy ra:</strong>
                                <ul>
                                    <li>Nội dung file gốc (.txt/.pdf) đã bị ai đó sửa đổi sau khi ký (dù chỉ 1 ký tự).</li>
                                    <li>File chữ ký (.sig) bị mất hoặc không khớp với file gốc.</li>
                                    <li>File không tồn tại trong hệ thống.</li>
                                </ul>
                            </div>
                        </div>
                    }
                </div>
            }

            <hr />
            <div class="text-center">
                <a href="@Url.Action("Sign", "Invoice", new { id = 1 })" class="btn btn-default btn-lg">
                    <i class="glyphicon glyphicon-arrow-left"></i> Quay lại trang Ký Hóa Đơn
                </a>
            </div>

        </div>
    </div>
</div>